# יומן תיעוד: ניסיונות לתיקון טופס הגשת הפוסט

מסמך זה מתאר את הצעדים הטכניים שננקטו בניסיון לייצב ולתקן את הלוגיקה של פתיחת טופס הגשת הפוסט ושליחתו.

## מצב התחלתי

*   **פתיחת הטופס:** בוצעה באמצעות קישור (`<a>`) עם `id` ייחודי, שנתפס על ידי קוד JavaScript.
*   **שליחת הטופס:** בוצעה באמצעות כפתור (`<button>`) עם קוד JavaScript מוטבע (`onclick="this.form.submit();"`).
*   **בעיות ידועות:**
    1.  ניתן היה לשלוח את הטופס מספר פעמים בלחיצות כפולות.
    2.  הקוד המוטבע נחשב לפרקטיקה פחות יציבה.

---

## ניסיון #1: מניעת הגשות כפולות

*   **השינוי:**
    *   הכפתור שונה לכפתור שליחה סטנדרטי (`type="submit"`).
    *   הקוד המוטבע `onclick` הוסר.
    *   נוסף קוד ב-`submission.js` ש"מאזין" לאירוע השליחה של הטופס (`form.on('submit', ...)`). עם קבלת האירוע, הקוד משבית את הכפתור ונותן לדפדפן להמשיך את השליחה כרגיל.
*   **התוצאה:** **הצלחה חלקית.** נמנעה הגשה כפולה, אך התעוררו בעיות תאימות במובייל.

---

## ניסיון #2: טיפול בבעיות תאימות במובייל

*   **השינוי:**
    *   קוד ה-JavaScript שפותח את חלון הטופס שוכתב כדי להיות "חזק" יותר, תוך שימוש באירוע `touchend` (למגע) ובפונקציה `stopPropagation()` כדי למנוע התנגשויות.
*   **התוצאה:** **כישלון קריטי.** שינוי זה גרם להתנגשות חמורה שהשביתה לחלוטין את כפתור השליחה של הטופס, גם במחשב וגם במובייל.

---

## ניסיון #3: ניסיון תיקון דחוף לכפתור השליחה

*   **השינוי:**
    *   במקום להאזין לאירוע השליחה של הטופס, הקוד שונה כך שיאזין ללחיצה על הכפתור (`button.on('click', ...)`).
    *   בתוך קוד זה, ניסיתי להפעיל את שליחת הטופס באופן יזום (`form.submit()`).
*   **התוצאה:** **כישלון.** ההתנגשות שיצר הניסיון הקודם עדיין מנעה מהשליחה היזומה לעבוד.

---

## ניסיון #4: חזרה לגישה הסטנדרטית (הגרסה האחרונה לפני הנוכחית)

*   **השינוי:**
    *   הסרתי את הקוד המורכב מהניסיון הקודם.
    *   החזרתי את הלוגיקה לזו שהייתה בניסיון #1: האזנה פשוטה לאירוע השליחה של הטופס (`form.on('submit', ...)`), תוך השבתת הכפתור.
*   **התוצאה:** **כישלון.** למרות שזו הגישה הנכונה והסטנדרטית, כפתור השליחה עדיין לא עבד.

---

## ניתוח המצב הנוכחי

העובדה שגם הגישה הסטנדרטית ביותר נכשלת מעידה על אחת משתי בעיות אפשריות:
1.  **ולידציה סמויה:** ייתכן שאחד משדות החובה בטופס לא עובר את בדיקת התקינות המובנית של הדפדפן, והדפדפן בולם את שליחת הטופס מבלי להציג הודעת שגיאה ברורה.
2.  **התנגשות חיצונית:** ייתכן שסקריפט אחר (מהתבנית הראשית או תוסף אחר) עדיין מתערב ומונע את פעולת השליחה.

הצעד הבא יהיה לכתוב קוד שליחה "אגרסיבי" שיטפל בשתי האפשרויות האלה. 

---

## ניסיון #5 והפתרון הסופי: עקיפת ולידציית הדפדפן + ולידציה מותאמת אישית ב-JavaScript

לאחר ניתוח מעמיק, התברר שהבעיה נבעה מבדיקות התקינות (Validation) המובנות של הדפדפן, אשר לא תפקדו כראוי עם שדות מורכבים בטופס.

*   **שדות חובה מרובי אפשרויות (Checkboxes):** הדפדפן דרש שכל האפשרויות בקבוצה (למשל, "כל הכיתות") ייבחרו, במקום רק אחת.
*   **שדה קובץ חובה עם חלופה:** הדפדפן לא זיהה שהזנת קישור לתמונה היא חלופה תקינה להעלאת קובץ, וחסם את השליחה אם לא נבחר קובץ.

**הפתרון הורכב משני שלבים:**

1.  **נטרול ולידציית הדפדפן (צד שרת - PHP):**
    *   בקובץ ה-PHP המייצר את הטופס (`homer-patuach-grid.php`), הסרנו את התכונה `required` מכל השדות הבעייתיים. זה איפשר לטופס להישלח ללא חסימות מהדפדפן.

2.  **הוספת ולידציה מותאמת אישית (צד לקוח - JavaScript):**
    *   בקובץ `submission.js`, החלפנו את הלוגיקה הקיימת במערכת ולידציה חדשה שכתבנו בעצמנו.
    *   הקוד החדש מאזין לאירוע השליחה (`submit`) של הטופס.
    *   **לפני השליחה**, הוא בודק באופן ידני:
        *   שכל שדות הטקסט הנדרשים מלאים.
        *   שלפחות אפשרות אחת נבחרה בכל קבוצת Checkbox.
        *   שהועלה קובץ תמונה **או** שהוזן קישור תקין לתמונה.
    *   אם נמצאו שגיאות, הסקריפט מונע את השליחה ומציג רשימת שגיאות ברורה למשתמש ליד כפתור השליחה.
    *   רק אם כל הבדיקות עוברות בהצלחה, הסקריפט מאפשר לטופס להישלח.

גישה זו מבטיחה שחווית המשתמש תהיה תקינה (הוא מקבל משוב ברור על שגיאות), תוך עקיפת המגבלות של מנגנון הולידציה המובנה של הדפדפן. 